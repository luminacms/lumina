"use strict";layui.define(["laydate","upload","admin"],function(e){function a(){this.config={verify:{required:[/[\S]+/,"必填项不能为空"],phone:[/^1\d{10}$/,"请输入正确的手机号"],email:[/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,"邮箱格式不正确"],url:[/(^#)|(^http(s*):\/\/[^\s]+\.[^\s]+)/,"链接格式不正确"],number:function(e){if(!e||isNaN(e))return"只能填写数字"},date:[/^(\d{4})[-\/](\d{1}|0\d{1}|1[0-2])([-\/](\d{1}|0\d{1}|[1-2][0-9]|3[0-1]))*$/,"日期格式不正确"],identity:[/(^\d{15}$)|(^\d{17}(x|X|\d)$)/,"请输入正确的身份证号"]}}}var b=layui.$,l=layui.laydate,o=layui.upload,h=layui.layer,y=layui.admin,n=layui.hint(),v=layui.device(),C="form",p=".layui-form",w="layui-this",_="layui-hide",$="layui-disabled";a.prototype.set=function(e){return b.extend(!0,this.config,e),this},a.prototype.verify=function(e){return b.extend(!0,this.config.verify,e),this},a.prototype.on=function(e,a){return layui.onevent.call(this,C,e,a)},a.prototype.val=function(e,t){b(p+'[lay-filter="'+e+'"]').each(function(e,a){var l=b(this);layui.each(t,function(e,a){var t,i=l.find('[name="'+e+'"]');i[0]&&("checkbox"===(t=i[0].type)?i[0].checked=a:"radio"===t?i.each(function(){this.value===a&&(this.checked=!0)}):i.val(a))})}),m.render(null,e)},a.prototype.render=function(e,a){var t=b(p+(a?'[lay-filter="'+a+'"]':"")),i={select:function(){function y(e,a){b(e.target).parent().hasClass(g)&&!a||(b("."+m).removeClass(m+"ed "+m+"up"),v&&x&&v.val(x)),v=null}function h(i,e,a){var s,l=b(this),t=i.find("."+g),n=t.find("input"),c=i.find("dl"),r=c.children("dd"),o=this.selectedIndex;if(!e){var d=function(){var e=i.offset().top+i.outerHeight()+5-L.scrollTop(),a=c.outerHeight();o=l[0].selectedIndex,i.addClass(m+"ed"),r.removeClass(_),s=null,r.eq(o).addClass(w).siblings().removeClass(w),e+a>L.height()&&a<=e&&i.addClass(m+"up"),f()},u=function(e){i.removeClass(m+"ed "+m+"up"),n.blur(),s=null,e||h(n.val(),function(e){var a=l[0].selectedIndex;e&&(x=b(l[0].options[a]).html(),0===a&&x===n.attr("placeholder")&&(x=""),n.val(x||""))})},f=function(){var e=c.children("dd."+w);if(e[0]){var a=e.position().top,t=c.height(),i=e.height();t<a&&c.scrollTop(a+c.scrollTop()-t+i-5),a<0&&c.scrollTop(a+c.scrollTop()-5)}};t.on("click",function(e){i.hasClass(m+"ed")?u():(y(e,!0),d()),c.find("."+k).remove()}),t.find(".layui-edge").on("click",function(){n.focus()}),n.on("keyup",function(e){9===e.keyCode&&d()}).on("keydown",function(n){var e=n.keyCode;9===e&&u();function r(i,l){var e,a;n.preventDefault();var t=function(){var e=c.children("dd."+w);if(c.children("dd."+_)[0]&&"next"===i){var a=c.children("dd:not(."+_+",."+$+")"),t=a.eq(0).index();if(0<=t&&t<e.index()&&!a.hasClass(w))return a.eq(0).prev()[0]?a.eq(0).prev():c.children(":last")}return l&&l[0]?l:s&&s[0]?s:e}();return a=t[i](),e=t[i]("dd:not(."+_+")"),a[0]?(s=t[i](),e[0]&&!e.hasClass($)||!s[0]?(e.addClass(w).siblings().removeClass(w),void f()):r(i,s)):s=null}38===e&&r("prev"),40===e&&r("next"),13===e&&(n.preventDefault(),c.children("dd."+w).trigger("click"))});var h=function(i,e,l){var n=0;layui.each(r,function(){var e=b(this),a=e.text(),t=-1===a.indexOf(i);(""===i||"blur"===l?i!==a:t)&&n++,"keyup"===l&&e[t?"addClass":"removeClass"](_)});var a=n===r.length;return e(a),a};a&&n.on("keyup",function(e){var a=this.value,t=e.keyCode;if(9===t||13===t||37===t||38===t||39===t||40===t)return!1;h(a,function(e){e?c.find("."+k)[0]||c.append('<p class="'+k+'">无匹配项</p>'):c.find("."+k).remove()},"keyup"),""===a&&c.find("."+k).remove(),f()}).on("blur",function(e){var a=l[0].selectedIndex;v=n,x=b(l[0].options[a]).html(),0===a&&x===n.attr("placeholder")&&(x=""),setTimeout(function(){h(n.val(),function(e){x||n.val("")},"blur")},200)}),r.on("click",function(){var e=b(this),a=e.attr("lay-value"),t=l.attr("lay-filter");return e.hasClass($)||(e.hasClass("layui-select-tips")?n.val(""):(n.val(e.text()),e.addClass(w)),e.siblings().removeClass(w),l.val(a).removeClass("layui-form-danger"),layui.event.call(this,C,"select("+t+")",{elem:l[0],value:a,othis:i}),u(!0)),!1}),i.find("dl>dt").on("click",function(e){return!1}),b(document).off("click",y).on("click",y)}}var v,p="请选择",m="layui-form-select",g="layui-select-title",k="layui-select-none",x="",e=t.find("select");e.each(function(e,a){var t=b(this),i=t.next("."+m),l=this.disabled,n=a.value,r=b(a.options[a.selectedIndex]),s=a.options[0];if("string"==typeof t.attr("lay-ignore"))return t.show();var c,o,d="string"==typeof t.attr("lay-search"),u=s&&!s.value&&s.innerHTML||p,f=b(['<div class="'+(d?"":"layui-unselect ")+m,(l?" layui-select-disabled":"")+'">','<div class="'+g+'">','<input type="text" placeholder="'+u+'" value="'+(n?r.html():"")+'"'+(d?"":" readonly")+' class="layui-input'+(d?"":" layui-unselect")+(l?" "+$:"")+'">','<i class="layui-edge"></i></div>','<dl class="layui-anim layui-anim-upbit'+(t.find("optgroup")[0]?" layui-select-group":"")+'">',(c=t.find("*"),o=[],layui.each(c,function(e,a){0!==e||a.value?"optgroup"===a.tagName.toLowerCase()?o.push("<dt>"+a.label+"</dt>"):o.push('<dd lay-value="'+a.value+'" class="'+(n===a.value?w:"")+(a.disabled?" "+$:"")+'">'+a.innerHTML+"</dd>"):o.push('<dd lay-value="" class="layui-select-tips">'+(a.innerHTML||p)+"</dd>")}),0===o.length&&o.push('<dd lay-value="" class="'+$+'">没有选项</dd>'),o.join("")+"</dl>"),"</div>"].join(""));i[0]&&i.remove(),t.after(f),h.call(this,f,l,d)})},checkbox:function(){var d={checkbox:["layui-form-checkbox","layui-form-checked","checkbox"],_switch:["layui-form-switch","layui-form-onswitch","switch"]},e=t.find("input[type=checkbox]");e.each(function(e,a){var t=b(this),i=t.attr("lay-skin"),l=(t.attr("lay-text")||"").split("|"),n=this.disabled;"switch"===i&&(i="_"+i);var r=d[i]||d.checkbox;if("string"==typeof t.attr("lay-ignore"))return t.show();var s,c=t.next("."+r[0]),o=b(['<div class="layui-unselect '+r[0],a.checked?" "+r[1]:"",n?" layui-checkbox-disbaled "+$:"",'"',i?' lay-skin="'+i+'"':"",">",(s={checkbox:[a.title.replace(/\s/g,"")?"<span>"+a.title+"</span>":"",'<i class="fa fa-check"></i>'].join(""),_switch:"<em>"+((a.checked?l[0]:l[1])||"")+"</em><i></i>"})[i]||s.checkbox,"</div>"].join(""));c[0]&&c.remove(),t.after(o),function(t,i){var l=b(this);t.on("click",function(){var e=l.attr("lay-filter"),a=(l.attr("lay-text")||"").split("|");l[0].disabled||(l[0].checked?(l[0].checked=!1,t.removeClass(i[1]).find("em").text(a[1])):(l[0].checked=!0,t.addClass(i[1]).find("em").text(a[0])),layui.event.call(l[0],C,i[2]+"("+e+")",{elem:l[0],value:l[0].value,othis:t}))})}.call(this,o,r)})},radio:function(){var s="layui-form-radio",c=["&#xe643;","&#xe63f;"],e=t.find("input[type=radio]");e.each(function(e,a){var t=b(this),i=t.next("."+s),l=this.disabled;if("string"==typeof t.attr("lay-ignore"))return t.show();i[0]&&i.remove();var n,r=b(['<div class="layui-unselect '+s,a.checked?" "+s+"ed":"",(l?" layui-radio-disbaled "+$:"")+'">','<i class="layui-anim fa">'+c[a.checked?0:1]+"</i>","<div>"+(n=a.title||"","string"==typeof t.next().attr("lay-radio")&&(n=t.next().html(),t.next().remove()),n)+"</div>","</div>"].join(""));t.after(r),function(l){var n=b(this),r="layui-anim-scaleSpring";l.on("click",function(){var e=n[0].name,a=n.parents(p),t=n.attr("lay-filter"),i=a.find("input[name="+e.replace(/(\.|#|\[|\])/g,"\\$1")+"]");n[0].disabled||(layui.each(i,function(){var e=b(this).next("."+s);this.checked=!1,e.removeClass(s+"ed"),e.find(".fa").removeClass(r).html(c[1])}),n[0].checked=!0,l.addClass(s+"ed"),l.find(".fa").addClass(r).html(c[0]),layui.event.call(n[0],C,"radio("+t+")",{elem:n[0],value:n[0].value,othis:l}))})}.call(this,r)})},img:function(){var e=t.find(".layui-form-img"),c='<li class="uploader__file" style="background-image: url(UPLOADEDFILE)"><div class="uploader__mask" style="display: none"><div class="mask__delete"><a href="javascript:;" class="j_delete" data-id="UPLOADEDFILE"><i class="fa fa-close"></i></a></div></div></li>';e.each(function(e,a){var t=b(this),i=b(['<div class="m-uploader clearfix">','<ul class="uploader__files"></ul>','<div class="img__picker" data-limit="9" ></div>',"</div>"].join(""));t.append(i),function(a){var i=b(this),l=a.find(".uploader__files"),n=a.find(".img__picker"),r=i.find("input[type=hidden]"),s=i.attr("lay-filter");a.on("click",function(){o.render({url:"/interface/core/upload",fileNumLimit:9,done:function(e){var t=r.val();9<=(t=1<t.length?t.split(","):[]).length||(b.each(e,function(e,a){t.push(a),9<=t.length&&n.hide(),l.append(c.replace(new RegExp(/(UPLOADEDFILE)/g),a))}),r.val(t.join(",")),layui.event.call(i[0],C,"img("+s+")",{elem:i[0],value:r.val(),othis:a}))}})})}.call(this,i)})},date:function(){t.find(".layui-form-date").each(function(e,a){l.render({elem:"#"+b(this).attr("id"),type:"date",format:"yyyy-MM-dd"})}),t.find(".layui-form-datetime").each(function(e,a){l.render({elem:"#"+b(this).attr("id"),type:"datetime",format:"yyyy-MM-dd HH:mm:ss"})}),t.find(".layui-form-time").each(function(e,a){l.render({elem:"#"+b(this).attr("id"),type:"time",format:"HH:mm:ss"})})}};return e?i[e]?i[e]():n.error("不支持的"+e+"表单渲染"):layui.each(i,function(e,a){a()}),this};function t(){var e=b(this),o=m.config.verify,d=null,u="layui-form-danger",i={},a=e.parents(p),t=a.find("*[lay-verify]"),l=e.parents("form")[0],n=a.find("input,select,textarea"),r=e.attr("lay-filter"),s=e.attr("lay-ajax");if(layui.each(t,function(e,n){var r=b(this),a=r.attr("lay-verify").split("|"),s=r.attr("lay-verType"),c=r.val();if(r.removeClass(u),layui.each(a,function(e,a){var t="",i="function"==typeof o[a];if(o[a]){var l=i?t=o[a](c,n):!o[a][0].test(c);if(t=t||o[a][1],l)return"tips"===s?h.tips(t,"string"==typeof r.attr("lay-ignore")||"select"!==n.tagName.toLowerCase()&&!/^checkbox|radio$/.test(n.type)?r:r.next(),{tips:1}):"alert"===s?h.alert(t,{title:"提示",shadeClose:!0}):h.msg(t,{icon:5,shift:6}),v.android||v.ios||n.focus(),r.addClass(u),d=!0}}),d)return d}),d)return!1;var c={};if(layui.each(n,function(e,a){if(a.name=(a.name||"").replace(/^\s*|\s*&/,""),a.name){if(/^.*\[\]$/.test(a.name)){var t=a.name.match(/^(.*)\[\]$/g)[0];c[t]=0|c[t],a.name=a.name.replace(/^(.*)\[\]$/,"$1["+c[t]+++"]")}/^checkbox|radio$/.test(a.type)&&!a.checked||(i[a.name]=a.value)}}),!s)return layui.event.call(this,C,"submit("+r+")",{elem:this,form:l,field:i});var f=e.parents("form");return y.request.ajax({type:f.attr("method"),url:f.attr("action"),data:i,success:function(e){if(0==e.errcode)return h.msg(e.msg),parent.layer&&setTimeout(function(){parent.layer.close(parent.layer.getFrameIndex(window.name))},1500),layui.event.call(this,C,"submit("+r+")",{elem:this,form:l,field:i});h.alert(e.msg,{title:"提示",shadeClose:!0})}}),!1}var m=new a,i=b("body"),L=b(window);m.render(),i.on("reset",p,function(){var e=b(this).attr("lay-filter");setTimeout(function(){m.render(null,e)},50)}),i.on("submit",p,t).on("click","*[lay-submit]",t),i.on("click","*[lay-submit-cancel]",function(){parent.layer.close(parent.layer.getFrameIndex(window.name))}),e(C,m)});