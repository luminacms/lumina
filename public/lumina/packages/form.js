"use strict";layui.define(["laydate","upload","admin"],function(e){function a(){this.config={verify:{required:[/[\S]+/,"必填项不能为空"],phone:[/^1\d{10}$/,"请输入正确的手机号"],email:[/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,"邮箱格式不正确"],url:[/(^#)|(^http(s*):\/\/[^\s]+\.[^\s]+)/,"链接格式不正确"],number:function(e){if(!e||isNaN(e))return"只能填写数字"},date:[/^(\d{4})[-\/](\d{1}|0\d{1}|1[0-2])([-\/](\d{1}|0\d{1}|[1-2][0-9]|3[0-1]))*$/,"日期格式不正确"],identity:[/(^\d{15}$)|(^\d{17}(x|X|\d)$)/,"请输入正确的身份证号"]}}}var b=layui.$,r=layui.laydate,c=layui.upload,h=layui.layer,v=layui.admin,n=layui.hint(),y=layui.device(),C="form",p=".layui-form",_="layui-this",w="layui-hide",$="layui-disabled";a.prototype.set=function(e){return b.extend(!0,this.config,e),this},a.prototype.verify=function(e){return b.extend(!0,this.config.verify,e),this},a.prototype.on=function(e,a){return layui.onevent.call(this,C,e,a)},a.prototype.val=function(e,t){b(p+'[lay-filter="'+e+'"]').each(function(e,a){var n=b(this);layui.each(t,function(e,a){var t,i=n.find('[name="'+e+'"]');i[0]&&("checkbox"===(t=i[0].type)?i[0].checked=a:"radio"===t?i.each(function(){this.value===a&&(this.checked=!0)}):i.val(a))})}),m.render(null,e)},a.prototype.render=function(e,a){var t=b(p+(a?'[lay-filter="'+a+'"]':"")),i={select:function(){function v(e,a){b(e.target).parent().hasClass(g)&&!a||(b("."+m).removeClass(m+"ed "+m+"up"),y&&k&&y.val(k)),y=null}function h(i,e,a){var s,n=b(this),t=i.find("."+g),l=t.find("input"),o=i.find("dl"),r=o.children("dd"),c=this.selectedIndex;if(!e){var d=function(){var e=i.offset().top+i.outerHeight()+5-L.scrollTop(),a=o.outerHeight();c=n[0].selectedIndex,i.addClass(m+"ed"),r.removeClass(w),s=null,r.eq(c).addClass(_).siblings().removeClass(_),e+a>L.height()&&a<=e&&i.addClass(m+"up"),f()},u=function(e){i.removeClass(m+"ed "+m+"up"),l.blur(),s=null,e||h(l.val(),function(e){var a=n[0].selectedIndex;e&&(k=b(n[0].options[a]).html(),0===a&&k===l.attr("placeholder")&&(k=""),l.val(k||""))})},f=function(){var e=o.children("dd."+_);if(e[0]){var a=e.position().top,t=o.height(),i=e.height();t<a&&o.scrollTop(a+o.scrollTop()-t+i-5),a<0&&o.scrollTop(a+o.scrollTop()-5)}};t.on("click",function(e){i.hasClass(m+"ed")?u():(v(e,!0),d()),o.find("."+x).remove()}),t.find(".layui-edge").on("click",function(){l.focus()}),l.on("keyup",function(e){9===e.keyCode&&d()}).on("keydown",function(l){var e=l.keyCode;9===e&&u();function r(i,n){var e,a;l.preventDefault();var t=function(){var e=o.children("dd."+_);if(o.children("dd."+w)[0]&&"next"===i){var a=o.children("dd:not(."+w+",."+$+")"),t=a.eq(0).index();if(0<=t&&t<e.index()&&!a.hasClass(_))return a.eq(0).prev()[0]?a.eq(0).prev():o.children(":last")}return n&&n[0]?n:s&&s[0]?s:e}();return a=t[i](),e=t[i]("dd:not(."+w+")"),a[0]?(s=t[i](),e[0]&&!e.hasClass($)||!s[0]?(e.addClass(_).siblings().removeClass(_),void f()):r(i,s)):s=null}38===e&&r("prev"),40===e&&r("next"),13===e&&(l.preventDefault(),o.children("dd."+_).trigger("click"))});var h=function(i,e,n){var l=0;layui.each(r,function(){var e=b(this),a=e.text(),t=-1===a.indexOf(i);(""===i||"blur"===n?i!==a:t)&&l++,"keyup"===n&&e[t?"addClass":"removeClass"](w)});var a=l===r.length;return e(a),a};a&&l.on("keyup",function(e){var a=this.value,t=e.keyCode;if(9===t||13===t||37===t||38===t||39===t||40===t)return!1;h(a,function(e){e?o.find("."+x)[0]||o.append('<p class="'+x+'">无匹配项</p>'):o.find("."+x).remove()},"keyup"),""===a&&o.find("."+x).remove(),f()}).on("blur",function(e){var a=n[0].selectedIndex;y=l,k=b(n[0].options[a]).html(),0===a&&k===l.attr("placeholder")&&(k=""),setTimeout(function(){h(l.val(),function(e){k||l.val("")},"blur")},200)}),r.on("click",function(){var e=b(this),a=e.attr("lay-value"),t=n.attr("lay-filter");return e.hasClass($)||(e.hasClass("layui-select-tips")?l.val(""):(l.val(e.text()),e.addClass(_)),e.siblings().removeClass(_),n.val(a).removeClass("layui-form-danger"),layui.event.call(this,C,"select("+t+")",{elem:n[0],value:a,othis:i}),u(!0)),!1}),i.find("dl>dt").on("click",function(e){return!1}),b(document).off("click",v).on("click",v)}}var y,p="请选择",m="layui-form-select",g="layui-select-title",x="layui-select-none",k="",e=t.find("select");e.each(function(e,a){var t=b(this),i=t.next("."+m),n=this.disabled,l=a.value,r=b(a.options[a.selectedIndex]),s=a.options[0];if("string"==typeof t.attr("lay-ignore"))return t.show();var o,c,d="string"==typeof t.attr("lay-search"),u=s&&!s.value&&s.innerHTML||p,f=b(['<div class="'+(d?"":"layui-unselect ")+m,(n?" layui-select-disabled":"")+'">','<div class="'+g+'">','<input type="text" placeholder="'+u+'" value="'+(l?r.html():"")+'"'+(d?"":" readonly")+' class="layui-input'+(d?"":" layui-unselect")+(n?" "+$:"")+'">','<i class="layui-edge"></i></div>','<dl class="layui-anim layui-anim-upbit'+(t.find("optgroup")[0]?" layui-select-group":"")+'">',(o=t.find("*"),c=[],layui.each(o,function(e,a){0!==e||a.value?"optgroup"===a.tagName.toLowerCase()?c.push("<dt>"+a.label+"</dt>"):c.push('<dd lay-value="'+a.value+'" class="'+(l===a.value?_:"")+(a.disabled?" "+$:"")+'">'+a.innerHTML+"</dd>"):c.push('<dd lay-value="" class="layui-select-tips">'+(a.innerHTML||p)+"</dd>")}),0===c.length&&c.push('<dd lay-value="" class="'+$+'">没有选项</dd>'),c.join("")+"</dl>"),"</div>"].join(""));i[0]&&i.remove(),t.after(f),h.call(this,f,n,d)})},checkbox:function(){var d={checkbox:["layui-form-checkbox","layui-form-checked","checkbox"],_switch:["layui-form-switch","layui-form-onswitch","switch"]},e=t.find("input[type=checkbox]");e.each(function(e,a){var t=b(this),i=t.attr("lay-skin"),n=(t.attr("lay-text")||"").split("|"),l=this.disabled;"switch"===i&&(i="_"+i);var r=d[i]||d.checkbox;if("string"==typeof t.attr("lay-ignore"))return t.show();var s,o=t.next("."+r[0]),c=b(['<div class="layui-unselect '+r[0],a.checked?" "+r[1]:"",l?" layui-checkbox-disbaled "+$:"",'"',i?' lay-skin="'+i+'"':"",">",(s={checkbox:[a.title.replace(/\s/g,"")?"<span>"+a.title+"</span>":"",'<i class="fa fa-check"></i>'].join(""),_switch:"<em>"+((a.checked?n[0]:n[1])||"")+"</em><i></i>"})[i]||s.checkbox,"</div>"].join(""));o[0]&&o.remove(),t.after(c),function(t,i){var n=b(this);t.on("click",function(){var e=n.attr("lay-filter"),a=(n.attr("lay-text")||"").split("|");n[0].disabled||(n[0].checked?(n[0].checked=!1,t.removeClass(i[1]).find("em").text(a[1])):(n[0].checked=!0,t.addClass(i[1]).find("em").text(a[0])),layui.event.call(n[0],C,i[2]+"("+e+")",{elem:n[0],value:n[0].value,othis:t}))})}.call(this,c,r)})},radio:function(){var s="layui-form-radio",o=["&#xe643;","&#xe63f;"],e=t.find("input[type=radio]");e.each(function(e,a){var t=b(this),i=t.next("."+s),n=this.disabled;if("string"==typeof t.attr("lay-ignore"))return t.show();i[0]&&i.remove();var l,r=b(['<div class="layui-unselect '+s,a.checked?" "+s+"ed":"",(n?" layui-radio-disbaled "+$:"")+'">','<i class="layui-anim fa">'+o[a.checked?0:1]+"</i>","<div>"+(l=a.title||"","string"==typeof t.next().attr("lay-radio")&&(l=t.next().html(),t.next().remove()),l)+"</div>","</div>"].join(""));t.after(r),function(n){var l=b(this),r="layui-anim-scaleSpring";n.on("click",function(){var e=l[0].name,a=l.parents(p),t=l.attr("lay-filter"),i=a.find("input[name="+e.replace(/(\.|#|\[|\])/g,"\\$1")+"]");l[0].disabled||(layui.each(i,function(){var e=b(this).next("."+s);this.checked=!1,e.removeClass(s+"ed"),e.find(".fa").removeClass(r).html(o[1])}),l[0].checked=!0,n.addClass(s+"ed"),n.find(".fa").addClass(r).html(o[0]),layui.event.call(l[0],C,"radio("+t+")",{elem:l[0],value:l[0].value,othis:n}))})}.call(this,r)})},img:function(){var e=t.find(".layui-form-img"),o='<li class="uploader__file" style="background-image: url(UPLOADEDFILE)"><div class="uploader__mask" style="display: none"><div class="mask__delete"><a href="javascript:;" class="j_delete" data-id="UPLOADEDFILE"><i class="fa fa-close"></i></a></div></div></li>';e.each(function(e,a){var t=b(this),i=b(['<div class="m-uploader clearfix">','<ul class="uploader__files"></ul>','<div class="img__picker" data-limit="9" ></div>',"</div>"].join(""));0<t.find(".m-uploader").length||(t.append(i),function(a){var i=b(this),n=a.find(".uploader__files"),l=a.find(".img__picker"),r=i.find("input[type=hidden]"),s=i.attr("lay-filter");a.on("click",function(){c.render({url:"/interface/core/upload",fileNumLimit:9,done:function(e){var t=r.val();9<=(t=1<t.length?t.split(","):[]).length||(b.each(e,function(e,a){t.push(a),9<=t.length&&l.hide(),n.append(o.replace(new RegExp(/(UPLOADEDFILE)/g),a))}),r.val(t.join(",")),layui.event.call(i[0],C,"img("+s+")",{elem:i[0],value:r.val(),othis:a}))}})})}.call(this,i.find(".img__picker")))})},date:function(){t.find(".layui-form-date").each(function(e,a){r.render({elem:a,type:b(a).attr("date-type")||"date"})}),t.find(".layui-form-daterange").each(function(e,a){var t=b(this),i="",n="",l=t.data("options");i=r.render({elem:t.find(".start_at")[0],min:l.min||"1900-1-1",max:l.max||"2999-12-31",type:l.type||"date",value:t.find(".start_at")[0].value,done:function(e,a){n.config.min=lay.extend({},a,{month:a.month-1})}}),n=r.render({elem:t.find(".end_at")[0],min:l.min||"1900-1-1",max:l.max||"2999-12-31",type:l.type||"date",value:t.find(".end_at")[0].value,done:function(e,a){i.config.max=lay.extend({},a,{month:a.month-1})}})})}};return e?i[e]?i[e]():n.error("不支持的"+e+"表单渲染"):layui.each(i,function(e,a){a()}),this};function t(){var e=b(this),c=m.config.verify,d=null,u="layui-form-danger",i={},a=e.parents(p),t=a.find("*[lay-verify]"),n=e.parents("form")[0],l=a.find("input,select,textarea"),r=e.attr("lay-filter"),s=e.attr("lay-ajax");if(layui.each(t,function(e,l){var r=b(this),a=r.attr("lay-verify").split("|"),s=r.attr("lay-verType"),o=r.val();if(r.removeClass(u),layui.each(a,function(e,a){var t="",i="function"==typeof c[a];if(c[a]){var n=i?t=c[a](o,l):!c[a][0].test(o);if(t=t||c[a][1],n)return"tips"===s?h.tips(t,"string"==typeof r.attr("lay-ignore")||"select"!==l.tagName.toLowerCase()&&!/^checkbox|radio$/.test(l.type)?r:r.next(),{tips:1}):"alert"===s?h.alert(t,{title:"提示",shadeClose:!0}):h.msg(t,{icon:5,shift:6}),y.android||y.ios||l.focus(),r.addClass(u),d=!0}}),d)return d}),d)return!1;var o={};if(layui.each(l,function(e,a){if(a.name=(a.name||"").replace(/^\s*|\s*&/,""),a.name){if(/^.*\[\]$/.test(a.name)){var t=a.name.match(/^(.*)\[\]$/g)[0];o[t]=0|o[t],a.name=a.name.replace(/^(.*)\[\]$/,"$1["+o[t]+++"]")}/^checkbox|radio$/.test(a.type)&&!a.checked||(i[a.name]=a.value)}}),!s)return layui.event.call(this,C,"submit("+r+")",{elem:this,form:n,field:i});var f=e.parents("form");return v.request.ajax({type:f.attr("method"),url:f.attr("action"),data:i,success:function(e){if(0==e.errcode)return h.msg(e.msg),parent.layer&&setTimeout(function(){parent.layer.close(parent.layer.getFrameIndex(window.name))},1500),layui.event.call(this,C,"submit("+r+")",{elem:this,form:n,field:i});h.alert(e.msg,{title:"提示",shadeClose:!0})}}),!1}var m=new a,i=b("body"),L=b(window);m.render(),i.on("reset",p,function(){var e=b(this).attr("lay-filter");setTimeout(function(){m.render(null,e)},50)}),i.on("submit",p,t).on("click","*[lay-submit]",t),i.on("click","*[lay-submit-cancel]",function(){parent.layer.close(parent.layer.getFrameIndex(window.name))}),e(C,m)});