"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}layui.define("form",function(e){function a(){var i=this,e=i.config,n=e.id||i.index;return a.that[n]=i,{config:a.config[n]=e,reload:function(e){i.reload.call(i,e)},getChecked:function(){return i.getChecked.call(i)},setChecked:function(e){return i.setChecked.call(i,e)}}}function n(e){var i=this;i.index=++r.index,i.config=x.extend({},i.config,r.config,e),i.render()}var x=layui.$,i=layui.form,l="tree",r={config:{},index:layui[l]?layui[l].index+1e4:0,set:function(e){var i=this;return i.config=x.extend({},i.config,e),i},on:function(e,i){return layui.onevent.call(this,l,e,i)}},b="layui-hide",c="layui-disabled",w="layui-tree-set",T="layui-tree-iconClick",L="layui-icon-addition",N="layui-icon-subtraction",S="layui-tree-entry",o="layui-tree-main",m="layui-tree-txt",A="layui-tree-pack",q="layui-tree-spread",F="layui-tree-setLineShort",I="layui-tree-showLine",H="layui-tree-lineExtend";n.prototype.config={data:[],showCheckbox:!1,showLine:!0,accordion:!1,onlyIconControl:!1,isJump:!1,edit:!1,text:{defaultNodeName:"未命名",none:"无数据"}},n.prototype.reload=function(e){var n=this;layui.each(e,function(e,i){i.constructor===Array&&delete n.config[e]}),n.config=x.extend(!0,{},n.config,e),n.render()},n.prototype.render=function(){var e=this,i=e.config,n=x('<div class="layui-tree'+(i.showCheckbox?" layui-form":"")+(i.showLine?" layui-tree-line":"")+'" lay-filter="LAY-tree-'+e.index+'"></div>');e.tree(n);var a=i.elem=x(i.elem);if(a[0]){if(i.showSearch&&n.prepend('<input type="text" class="layui-input layui-tree-search" placeholder="请输入关键字进行过滤">'),e.key=i.id||e.index,e.elem=n,e.elemNone=x('<div class="layui-tree-emptyText">'+i.text.none+"</div>"),a.html(e.elem),0==e.elem.find(".layui-tree-set").length)return e.elem.append(e.elemNone);i.drag&&e.drag(),i.showCheckbox&&e.renderForm("checkbox"),e.elem.find(".layui-tree-set").each(function(){var e=x(this);e.parent(".layui-tree-pack")[0]||e.addClass("layui-tree-setHide"),!e.next()[0]&&e.parents(".layui-tree-pack").eq(1).hasClass("layui-tree-lineExtend")&&e.addClass(F),e.next()[0]||e.parents(".layui-tree-set").eq(0).next()[0]||e.addClass(F)}),e.events()}},n.prototype.renderForm=function(e){i.render(e,"LAY-tree-"+this.index)},n.prototype.tree=function(r,e){var t=this,d=t.config,i=e||d.data;layui.each(i,function(e,i){var n=i.children&&0<i.children.length,a=x('<div class="layui-tree-pack" '+(i.spread?'style="display: block;"':"")+'"></div>'),l=x(['<div data-id="'+i.id+'" class="layui-tree-set'+(i.spread?" layui-tree-spread":"")+(i.checked?" layui-tree-checkedFirst":"")+'">',"<div "+(d.drag&&!i.fixed?'draggable="true"':"")+' class="layui-tree-entry">','<div class="layui-tree-main">',d.showLine?n?'<span class="layui-tree-iconClick layui-tree-icon"><i class="layui-icon '+(i.spread?"layui-icon-subtraction":"layui-icon-addition")+'"></i></span>':'<span class="layui-tree-iconClick"><i class="layui-icon layui-icon-file"></i></span>':'<span class="layui-tree-iconClick"><i class="layui-tree-iconArrow '+(n?"":b)+'"></i></span>',d.showCheckbox?'<input type="checkbox" name="layuiTreeCheck" lay-skin="primary" '+(i.disabled?"disabled":"")+'  value="'+i.id+'">':"",d.isJump&&i.href?'<a href="'+i.href+'" target="_blank" class="'+m+'">'+(i.title||i.label||d.text.defaultNodeName)+"</a>":'<span class="'+m+(i.disabled?" "+c:"")+'">'+(i.title||i.label||d.text.defaultNodeName)+"</span>","</div>",function(){if(!d.edit)return"";var n={add:'<i class="layui-icon layui-icon-add-1"  data-type="add"></i>',update:'<i class="layui-icon layui-icon-edit" data-type="update"></i>',del:'<i class="layui-icon layui-icon-delete" data-type="del"></i>'},a=['<div class="layui-btn-group layui-tree-btnGroup">'];return!0===d.edit&&(d.edit=["update","del"]),"object"===_typeof(d.edit)?(layui.each(d.edit,function(e,i){a.push(n[i]||"")}),a.join("")+"</div>"):void 0}(),"</div></div>"].join(""));n&&(l.append(a),t.tree(a,i.children)),r.append(l),l.prev("."+w)[0]&&l.prev().children(".layui-tree-pack").addClass("layui-tree-showLine"),n||l.parent(".layui-tree-pack").addClass("layui-tree-lineExtend"),t.spread(l,i),d.showCheckbox&&t.checkClick(l,i),d.edit&&t.operate(l,i)})},n.prototype.spread=function(l,e){var r=this.config,i=l.children("."+S),n=i.children("."+o),a=i.find("."+T),t=i.find("."+m),d=r.onlyIconControl?a:n,s="";d.on("click",function(e){var i=l.children("."+A),n=d.children(".layui-icon")[0]?d.children(".layui-icon"):d.find(".layui-tree-icon").children(".layui-icon");if(i[0]){if(l.hasClass(q))l.removeClass(q),i.slideUp(200),n.removeClass(N).addClass(L);else if(l.addClass(q),i.slideDown(200),n.addClass(N).removeClass(L),r.accordion){var a=l.siblings("."+w);a.removeClass(q),a.children("."+A).slideUp(200),a.find(".layui-tree-icon").children(".layui-icon").removeClass(N).addClass(L)}}else s="normal"}),t.on("click",function(){x(this).hasClass(c)||(s=l.hasClass(q)?r.onlyIconControl?"open":"close":r.onlyIconControl?"close":"open",r.click&&r.click({elem:l,state:s,data:e}))})},n.prototype.setCheckbox=function(e,i,n){this.config;var t=n.prop("checked");"object"!==_typeof(i.children)&&!e.find("."+A)[0]||e.find("."+A).find('input[name="layuiTreeCheck"]').each(function(){this.disabled||(this.checked=t)});!function e(i){if(i.parents("."+w)[0]){var n,a=i.parent("."+A),l=a.parent(),r=a.prev().find('input[name="layuiTreeCheck"]');t?r.prop("checked",t):(a.find('input[name="layuiTreeCheck"]').each(function(){this.checked&&(n=!0)}),n||r.prop("checked",!1)),e(l)}}(e),this.renderForm("checkbox")},n.prototype.checkClick=function(a,l){var r=this,t=r.config;a.children("."+S).children("."+o).on("click",'input[name="layuiTreeCheck"]+',function(e){layui.stope(e);var i=x(this).prev(),n=i.prop("checked");i.prop("disabled")||(r.setCheckbox(a,l,i),t.oncheck&&t.oncheck({elem:a,checked:n,data:l}))})},n.prototype.operate=function(f,p){var y=this,C=y.config,e=f.children("."+S),v=e.children("."+o);e.children(".layui-tree-btnGroup").on("click",".layui-icon",function(e){layui.stope(e);var i=x(this).data("type"),n=f.children("."+A),a={data:p,type:i,elem:f};if("add"==i){n[0]||(C.showLine?(v.find("."+T).addClass("layui-tree-icon"),v.find("."+T).children(".layui-icon").addClass(L).removeClass("layui-icon-file")):v.find(".layui-tree-iconArrow").removeClass(b),f.append('<div class="layui-tree-pack"></div>'));var l=C.operate&&C.operate(a),r={};if(r.title=C.text.defaultNodeName,r.id=l,y.tree(f.children("."+A),[r]),C.showLine)if(n[0])n.hasClass(H)||n.addClass(H),f.find("."+A).each(function(){x(this).children("."+w).last().addClass(F)}),n.children("."+w).last().prev().hasClass(F)?n.children("."+w).last().prev().removeClass(F):n.children("."+w).last().removeClass(F),!f.parent("."+A)[0]&&f.next()[0]&&n.children("."+w).last().removeClass(F);else{var t=f.siblings("."+w),d=1,s=f.parent("."+A);layui.each(t,function(e,i){x(i).children("."+A)[0]||(d=0)}),1==d?(t.children("."+A).addClass(I),t.children("."+A).children("."+w).removeClass(F),f.children("."+A).addClass(I),s.removeClass(H),s.children("."+w).last().children("."+A).children("."+w).last().addClass(F)):f.children("."+A).children("."+w).addClass(F)}if(!C.showCheckbox)return;if(v.find('input[name="layuiTreeCheck"]')[0].checked)f.children("."+A).children("."+w).last().find('input[name="layuiTreeCheck"]')[0].checked=!0;y.renderForm("checkbox")}else if("update"==i){var c=v.children("."+m).html();v.children("."+m).html(""),v.append('<input type="text" class="layui-tree-editInput">'),v.children(".layui-tree-editInput").val(c).focus();var o=function(e){var i=e.val().trim();i=i||C.text.defaultNodeName,e.remove(),v.children("."+m).html(i),a.data.title=i,C.operate&&C.operate(a)};v.children(".layui-tree-editInput").blur(function(){o(x(this))}),v.children(".layui-tree-editInput").on("keydown",function(e){13===e.keyCode&&(e.preventDefault(),o(x(this)))})}else{if(C.operate&&C.operate(a),a.status="remove",!f.prev("."+w)[0]&&!f.next("."+w)[0]&&!f.parent("."+A)[0])return f.remove(),void y.elem.append(y.elemNone);if(f.siblings("."+w).children("."+S)[0]){if(C.showCheckbox){!function e(i){if(i.parents("."+w)[0]){var n=i.siblings("."+w).children("."+S),a=i.parent("."+A).prev(),l=a.find('input[name="layuiTreeCheck"]')[0],r=1,t=0;0==l.checked&&(n.each(function(e,i){var n=x(i).find('input[name="layuiTreeCheck"]')[0];0!=n.checked||n.disabled||(r=0),n.disabled||(t=1)}),1==r&&1==t&&(l.checked=!0,y.renderForm("checkbox"),e(a.parent("."+w))))}}(f)}if(C.showLine){t=f.siblings("."+w),d=1,s=f.parent("."+A);layui.each(t,function(e,i){x(i).children("."+A)[0]||(d=0)}),1==d?(n[0]||(s.removeClass(H),t.children("."+A).addClass(I),t.children("."+A).children("."+w).removeClass(F)),f.next()[0]?s.children("."+w).last().children("."+A).children("."+w).last().addClass(F):f.prev().children("."+A).children("."+w).last().addClass(F),f.next()[0]||f.parents("."+w)[1]||f.parents("."+w).eq(0).next()[0]||f.prev("."+w).addClass(F)):!f.next()[0]&&f.hasClass(F)&&f.prev().addClass(F)}}else{var h=f.parent("."+A).prev();if(C.showLine){h.find("."+T).removeClass("layui-tree-icon"),h.find("."+T).children(".layui-icon").removeClass(N).addClass("layui-icon-file");var u=h.parents("."+A).eq(0);u.addClass(H),u.children("."+w).each(function(){x(this).children("."+A).children("."+w).last().addClass(F)})}else h.find(".layui-tree-iconArrow").addClass(b);f.parents("."+w).eq(0).removeClass(q),f.parent("."+A).remove()}f.remove()}})},n.prototype.drag=function(){var k=this,g=k.config;k.elem.on("dragstart","."+S,function(){var e=x(this).parent("."+w),i=e.parents("."+w)[0]?e.parents("."+w).eq(0):"未找到父节点";g.dragstart&&g.dragstart(e,i)}),k.elem.on("dragend","."+S,function(e){var s=(e=e||event).clientY,c=x(this).parent("."+w),o=c.height(),h=c.offset().top,i=k.elem.find("."+w),u=k.elem.height()+k.elem.offset().top-13,a=c.parents("."+w)[0],l=c.next()[0];if(a)var f=c.parent("."+A),p=c.parents("."+w).eq(0),r=p.parent("."+A),y=p.offset().top,C=c.siblings(),v=p.children("."+A).children("."+w).length;function m(d){if(a||l||k.elem.children("."+w).last().children("."+A).children("."+w).last().addClass(F),a)if(1==v)g.showLine?(d.find("."+T).removeClass("layui-tree-icon"),d.find("."+T).children(".layui-icon").removeClass(N).addClass("layui-icon-file"),r.addClass(H),r.children("."+w).children("."+A).each(function(){x(this).children("."+w).last().addClass(F)})):d.find(".layui-tree-iconArrow").addClass(b),d.children("."+A).remove(),d.removeClass(q);else{if(g.showLine){var n=1;layui.each(C,function(e,i){x(i).children("."+A)[0]||(n=0)}),1==n?(c.children("."+A)[0]||(f.removeClass(H),C.children("."+A).addClass(I),C.children("."+A).children("."+w).removeClass(F)),f.children("."+w).last().children("."+A).children("."+w).last().addClass(F),l||d.parents("."+w)[0]||d.next()[0]||f.children("."+w).last().addClass(F)):!l&&c.hasClass(F)&&f.children("."+w).last().addClass(F)}if(g.showCheckbox){!function e(i){if(i){if(!i.parents("."+w)[0])return}else if(!d[0])return;var n=i?i.siblings().children("."+S):C.children("."+S),a=i?i.parent("."+A).prev():f.prev(),l=a.find('input[name="layuiTreeCheck"]')[0],r=1,t=0;0==l.checked&&(n.each(function(e,i){var n=x(i).find('input[name="layuiTreeCheck"]')[0];0!=n.checked||n.disabled||(r=0),n.disabled||(t=1)}),1==r&&1==t&&(l.checked=!0,k.renderForm("checkbox"),e(a.parent("."+w)||d)))}()}}else c.removeClass("layui-tree-setHide")}i.each(function(){if(0!=x(this).height()){if(h<s&&s<h+o)return void(g.dragend&&g.dragend("drag error"));if(1==v&&y<s&&s<h+o)return void(g.dragend&&g.dragend("drag error"));var e=x(this).offset().top;if(e<s&&s<e+15){if(x(this).children("."+A)[0]||(g.showLine?(x(this).find("."+T).eq(0).addClass("layui-tree-icon"),x(this).find("."+T).eq(0).children(".layui-icon").addClass(L).removeClass("layui-icon-file")):x(this).find(".layui-tree-iconArrow").removeClass(b),x(this).append('<div class="layui-tree-pack"></div>')),x(this).children("."+A).append(c),m(p),g.showLine){var i=x(this).children("."+A).children("."+w);if(c.children("."+A).children("."+w).last().addClass(F),1==i.length){var n=x(this).siblings("."+w),a=1,l=x(this).parent("."+A);layui.each(n,function(e,i){x(i).children("."+A)[0]||(a=0)}),1==a?(n.children("."+A).addClass(I),n.children("."+A).children("."+w).removeClass(F),x(this).children("."+A).addClass(I),l.removeClass(H),l.children("."+w).last().children("."+A).children("."+w).last().addClass(F).removeClass("layui-tree-setHide")):x(this).children("."+A).children("."+w).addClass(F).removeClass("layui-tree-setHide")}else c.prev("."+w).hasClass(F)?(c.prev("."+w).removeClass(F),c.addClass(F)):(c.removeClass("layui-tree-setLineShort layui-tree-setHide"),c.children("."+A)[0]?c.prev("."+w).children("."+A).children("."+w).last().removeClass(F):c.siblings("."+w).find("."+A).each(function(){x(this).children("."+w).last().addClass(F)})),x(this).next()[0]||c.addClass(F)}if(g.showCheckbox)if(x(this).children("."+S).find('input[name="layuiTreeCheck"]')[0].checked)c.children("."+S).find('input[name="layuiTreeCheck"]+').click();return g.dragend&&g.dragend("drag success",c,x(this)),!1}if(s<e){if(x(this).before(c),m(p),g.showLine){var r=c.children("."+A),t=x(this).parents("."+w).eq(0),d=t.children("."+A).children("."+w).last();if(r[0]){c.removeClass(F),r.children("."+w).last().removeClass(F);n=c.siblings("."+w),a=1;layui.each(n,function(e,i){x(i).children("."+A)[0]||(a=0)}),1==a?t[0]&&(n.children("."+A).addClass(I),n.children("."+A).children("."+w).removeClass(F),d.children("."+A).children("."+w).last().addClass(F).removeClass(I)):c.children("."+A).children("."+w).last().addClass(F),!t.parent("."+A)[0]&&t.next()[0]&&d.removeClass(F)}else t.hasClass(H)||t.addClass(H),t.find("."+A).each(function(){x(this).children("."+w).last().addClass(F)});t[0]||(c.addClass("layui-tree-setHide"),c.children("."+A).children("."+w).last().removeClass(F))}if(t[0]&&g.showCheckbox)if(t.children("."+S).find('input[name="layuiTreeCheck"]')[0].checked)c.children("."+S).find('input[name="layuiTreeCheck"]+').click();return g.dragend&&g.dragend("拖拽成功，插入目标节点上方",c,x(this)),!1}if(u<s)return k.elem.children("."+w).last().children("."+A).addClass(I),k.elem.append(c),m(p),c.prev().children("."+A).children("."+w).last().removeClass(F),c.addClass("layui-tree-setHide"),c.children("."+A).children("."+w).last().addClass(F),g.dragend&&g.dragend("拖拽成功，插入最外层节点",c,k.elem),!1}})})},n.prototype.events=function(){var l=this,r=l.config,e=l.elem.find(".layui-tree-checkedFirst");layui.each(e,function(e,i){x(i).children("."+S).find('input[name="layuiTreeCheck"]+').trigger("click")}),l.elem.find(".layui-tree-search").on("keyup",function(){var e=x(this),i=e.val(),n=e.nextAll(),a=[];n.find("."+m).each(function(){var e=x(this).parents("."+S);if(-1!=x(this).html().indexOf(i)){a.push(x(this).parent());!function e(i){i.addClass("layui-tree-searchShow"),i.parent("."+A)[0]&&e(i.parent("."+A).parent("."+w))}(e.parent("."+w))}}),n.find("."+S).each(function(){var e=x(this).parent("."+w);e.hasClass("layui-tree-searchShow")||e.addClass(b)}),0==n.find(".layui-tree-searchShow").length&&l.elem.append(l.elemNone),r.onsearch&&r.onsearch({elem:a})}),l.elem.find(".layui-tree-search").on("keydown",function(){x(this).nextAll().find("."+S).each(function(){x(this).parent("."+w).removeClass("layui-tree-searchShow "+b)}),x(".layui-tree-emptyText")[0]&&x(".layui-tree-emptyText").remove()})},n.prototype.getChecked=function(){var e=this.config,i=[],n=[];this.elem.find(".layui-form-checked").each(function(){i.push(x(this).prev()[0].value)});return function l(e,r){layui.each(e,function(e,a){layui.each(i,function(e,i){if(a.id==i){var n=x.extend({},a);return delete n.children,r.push(n),a.children&&(n.children=[],l(a.children,n.children)),!0}})})}(x.extend({},e.data),n),n},n.prototype.setChecked=function(r){this.config;this.elem.find("."+w).each(function(e,i){var n=x(this).data("id"),a=x(i).children("."+S).find('input[name="layuiTreeCheck"]'),l=a.next();if("number"==typeof r){if(n==r)return a[0].checked||l.click(),!1}else-1!=x.inArray(n,r)&&(a[0].checked||l.click())})},a.that={},a.config={},r.reload=function(e,i){var n=a.that[e];return n.reload(i),a.call(n)},r.getChecked=function(e){return a.that[e].getChecked()},r.setChecked=function(e,i){return a.that[e].setChecked(i)},r.render=function(e){var i=new n(e);return a.call(i)},e(l,r)});