"use strict";layui.extend({webuploader:"lib/upload/webuploader/webuploader"}).define(["util","webuploader"],function(e){function i(e){var i=this;i.uploadObj={},i.uploadFiles=[],i.config=t.extend({},i.config,l.config,e),i.render()}var t=layui.jquery,o=layui.layer,s=layui.util,n=layui.webuploader,a="fileUpload",l={config:{},set:function(e){var i=this;return i.config=t.extend({},i.config,e),i},on:function(e,i){return layui.onevent.call(this,a,e,i)}};i.prototype.config={modelId:"",fileIcon:{document:layui.cache.base+"/lib/upload/imgs/documents.png",doc:layui.cache.base+"/lib/upload/imgs/doc.png",pdf:layui.cache.base+"/lib/upload/imgs/pdf.png"}},i.prototype.render=function(){var e=this.config;layui.link(layui.cache.base+"lib/upload/upload.css"),this.uploadObj=n.create({pick:e.elem,auto:!0,swf:layui.cache.base+"/lib/upload/webuploader/Uploader.swf",server:e.url,headers:t.extend({"X-CSRF-TOKEN":t('meta[name="csrf-token"]').attr("content"),"X-Requested-With":"XMLHttpRequest"},e.headers),fileNumLimit:1,accept:{title:"File",extensions:"zip,doc,docx,jpg,gif,png,jpeg,pdf"}}),this.events()},i.prototype.events=function(e){var i=this.uploadObj,l=this.config,d=t("#"+l.modelId).find(".uploader__files");i.on("fileQueued",function(e){}),i.on("uploadProgress",function(e,i){var o=t("#"+e.id),n=o.find(".progress span");n.length||(n=t('<p class="progress"><span></span></p>').appendTo(o).find("span")),n.css("width",100*i+"%")}),i.on("uploadSuccess",function(e,i){t("#"+e.id).addClass("upload-state-done");e.type;var o,n=s.getExtension(e.name);if(o=void 0!==l.fileIcon[n]?l.fileIcon[n]:l.fileIcon.document,0==i.errcode){var a='<li class="uploader__file" data-id="'+e.id+'" data-url="'+i.url+'"><div class="thumb" style="background-image: url('+o+')"></div><div class="fileinfo"><p class="name">'+e.name+'</p><p class="size">'+s.formatSize(e.size)+'</p></div><a href="javascript:;" class="j_delete"><i class="fa fa-delete"></i></a></div></div></li>';d.append(a)}}),i.on("uploadError",function(e){var i=t("#"+e.id),o=i.find("div.error");o.length||(o=t('<div class="error"></div>').appendTo(i)),o.text("上传失败")}),i.on("uploadComplete",function(e){t("#"+e.id).find(".progress").remove()})},i.prototype.done=function(e){var i=this;i.uploadFiles.length<1?o.msg("请选择图片",{icon:5}):(o.close(e),"function"==typeof i.config.done&&i.config.done(i.uploadFiles))},l.render=function(e){return new i(e)},e(a,l)});