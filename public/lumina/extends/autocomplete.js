"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}layui.define(["laytpl"],function(e){var hint=layui.hint(),$=layui.jquery,laytpl=layui.laytpl,layer=layui.layer,module="autocomplete",filter="lay-autocomplete",container="layui-form-autocomplete",container_focus="layui-form-autocomplete-focus",system={config:{template:['<div class="layui-form-autocomplete">','<dl class="layui-anim layui-anim-upbit">',"</dl>","</div>"].join(""),layout:['<dd data-index="{{d.index}}">{{d.text}}</dd>'].join(""),template_txt:"{{d.text}}",template_val:"{{d.value}}",cache:!1},index:layui.autocomplete?layui.autocomplete.index+1e4:0,data:{}},callback=function e(){var t=this.config,n=t.id;return n&&(e.config[n]=t),{config:this.config}},job=function(e){var t=this;t.index=++system.index,t.config=$.extend({},t.config,system.config,e),t.render()};job.prototype.config={text:{none:"无数据",loading:"加载中"},response:{code:"errcode",data:"data"},request:{keywords:"search"},time_limit:500,ajax:[],_ajax:null,data:{},temp_data:{},params:{},filter:"",method:"get",ajaxParams:{}},job.prototype.render=function(){var e=this,t=e.config;if(t.elem=$(t.elem),t.where=t.where||{},!t.elem[0])return e;var n=t.elem,a=n.next("."+container),i=e.elem=$(laytpl(t.template).render({}));t.id=e.id,a&&a.remove(),n.attr("autocomplete","off"),n.after(i),e.events()},job.prototype.pullData=function(){var _$$extend,_self=this,_config=_self.config,_elem=_config.elem,_container=_elem.next("."+container),_dom=_container.find("dl");return _config.filter?_config.cache&&_config.data[_self.index]?_self.renderData(_config.data[_self.index]):(_config.cache||null==_config.ajax[_self.index]||_config.ajax[_self.index].abort(),void(_config.ajax[_self.index]=$.ajax($.extend({type:_config.method||"get",url:_config.url,data:$.extend((_$$extend={},_defineProperty(_$$extend,_config.request.keywords,_config.filter),_defineProperty(_$$extend,"t",(new Date).getTime()),_$$extend),_config.params),contentType:"text/json,charset=utf-8",dataType:"json",beforeSend:function(){_container.addClass(container_focus),_dom.html(['<dd style="text-align: center" autocomplete-load>',_config.text.loading,"</dd>"].join(""))},success:function success(resp){return 0!=eval("resp."+_config.response.code)?layer.msg(eval("resp."+_config.response.data)):_config.data[_self.index]=eval("resp."+_config.response.data),_self.renderData(_config.data[_self.index])},error:function(){hint.error("请求失败")},complete:function(){delete _config.ajax[_self.index]}},_config.ajaxParams)))):_self.renderData([])},job.prototype.renderData=function(e){var i=this,o=i.config,t=o.elem.next("."+container),n=t.find("dl"),r=[];o.temp_data[i.index]=[],layui.each(e,function(n,a){a instanceof Object?layui.each(a,function(e,t){if(-1<t.toString().toLowerCase().indexOf(o.filter.toLowerCase()))return o.temp_data[i.index].push(a),r.push(laytpl(o.layout).render({index:n,text:laytpl(o.template_txt).render(a)})),!0}):-1<a.toString().toLowerCase().indexOf(o.filter.toLowerCase())&&(o.temp_data[i.index].push(a),r.push(laytpl(o.layout).render({index:n,text:laytpl(o.template_txt).render(a)})))}),n.html(r.join("")),0<r.length?t.addClass(container_focus):t.removeClass(container_focus)},job.prototype.events=function(){var o=this,r=o.config,l=r.elem,c=l.next("."+container),d=c.find("dl");l.unbind("focus").unbind("input propertychange").on("focus",function(){r.filter=this.value,o.renderData(r.data[o.index])}).on("input propertychange",function(e){var t=this.value;clearTimeout(r._ajax),r._ajax=setTimeout(function(){r.filter=t,o.pullData()},r.time_limit)}),$(document).on("click",function(e){var t=e.target,n=d.find(t),a=0<n.length?n.closest("dd"):void 0;if(t===l[0])return!1;if(void 0!==a){if(void 0!==a.attr("autocomplete-load"))return!1;var i=r.temp_data[o.index][a.index()];l.val(laytpl(r.template_val).render(i)),null==r.onselect||r.onselect(i)}c.removeClass(container_focus)})},callback.config={},callback.job={},system.init=function(e,t){$(e?'input[lay-filter="'+e+'"]':"input["+filter+"]").each(function(e,t){var n=$.extend(system.config,{elem:this,url:$(t).attr("lay-url")});system.render(n)})},system.render=function(e){var t=new job(e);return callback.call(t)},system.init(),e(module,system)});