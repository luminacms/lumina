"use strict";layui.define(["jquery","laytpl","layer"],function(i){function e(i){this.option=i,this.domContent="",this.textArr=[],this.textStr="",this.valueArr=[],this.onOff=!1,this.positionArr=[],this.blockData={},this.initOption()}var l=layui.jquery,n=layui.laytpl,o=layui.layer,t=3e3;e.prototype={constructor:e,initOption:function(){var t=this;if(t.option.elem?t.elem=t.option.elem:function(){throw"缺少elem节点选择器"}(),t.triggerType="change"===t.option.triggerType?"mouseenter":"click",t.changeOnSelect=t.option.changeOnSelect||!1,t.option.data)return t.d=t.option.data,void t.callback();if(!t.option.url)throw"选择器"+t.elem+"缺少data或url参数";l.ajax({url:t.option.url,type:t.option.type?t.option.type:"get",data:t.option.where?t.option.where:{},success:function(i){if(0===i.Code)return t.d=i.Data,void t.callback();o.alert(i.Msg,{title:"选择器"+t.elem+"获取数据失败",icon:2})}})},init:function(){var i=l(this.elem);i.append('<div class="urp-cascader-content"></div>'),i.data("cascader","elem")},initFirst:function(){var i=n('<ul class="urp-cascader-child">{{# for(var i=0;i<d.length;i++){ }}<li>{{ d[i].label }}<i class="fa fa-angle-double-right" ></i></li>{{# } }}</ul>').render(this.d);l(this.elem).find(".urp-cascader-content").append(i),this.domContent=l(this.elem).find(".urp-cascader-content");for(var t=0;t<this.d.length;t++)"children"in this.d[t]&&0<this.d[t].children.length?this.domContent.find("ul.urp-cascader-child li").eq(t).find("i").show():this.domContent.find("ul.urp-cascader-child li").eq(t).find("i").hide()},getBlockData:function(i,t){i.stopPropagation(),this.floor=l(t).parent().index();var e=l(t).index();this.positionArr.length=this.floor,this.positionArr.push(e),this.blockData=this.d[this.positionArr[0]];for(var n=1;n<=this.floor;n++)this.blockData=this.blockData.children[this.positionArr[n]]},initChild:function(i){this.domContent.find(".urp-cascader-child:gt("+this.floor+")").remove(),this.textArr.length=this.floor,this.textArr.push(this.blockData.label),this.valueArr.length=this.floor,this.valueArr.push(this.blockData.value);var t=n('<ul class="urp-cascader-child">{{# for(var i=0;i< d.length;i++){ }}<li>{{ d[i].label }}<i class="fa fa-angle-double-right"></i></li>{{# } }}</ul>').render(this.blockData.children);this.domContent.append(t);for(var e=0;e<this.blockData.children.length;e++)"children"in this.blockData.children[e]&&0<this.blockData.children[e].children.length?this.domContent.find("ul.urp-cascader-child:gt("+this.floor+")").find("li").eq(e).find("i").show():this.domContent.find("ul.urp-cascader-child:gt("+this.floor+")").find("li").eq(e).find("i").hide();this.changeOnSelect&&(this.textStr=this.textArr.join("/"),l(this.elem).val(this.textStr),"initValue"!==i&&this.option.success&&this.option.success(this.valueArr,this.textArr))},finishInitData:function(i){this.domContent.find(".urp-cascader-child:gt("+this.floor+")").remove(),this.textArr.length=this.floor,this.textArr.push(this.blockData.label),this.valueArr.length=this.floor,this.valueArr.push(this.blockData.value),this.textStr=this.textArr.join(" > "),this.onOff=!1,"initValue"!==i&&this.option.success&&this.option.success(this.valueArr,this.textArr)},initValue:function(){var a=this;l.isArray(this.option.value)&&0<this.option.value.length&&function(){var i=a.option.value;l(a.elem).trigger("click");var n=[],o=a.d;i.forEach(function(i,t){if(!o)throw"选择器"+a.elem+"初始化数据不匹配";for(var e=0;e<o.length;e++)o[e].value==i&&(n.push(e),a.domContent.find(".urp-cascader-child").eq(t).find("li").eq(e).trigger(a.triggerType,"initValue"),l(a.elem).siblings(".urp-cascader-content").find("ul").finish());o[n[t]]?o=o[n[t]].children:function(){throw"选择器"+a.elem+"初始化数据不匹配"}()})}()},callback:function(){this.init(),this.initFirst();var n=this;n.domContent.on(n.triggerType,".urp-cascader-child li",function(i,t){var e=this;n.getBlockData(i,this),l(this).addClass("active").siblings("li").removeClass("active"),"children"in n.blockData&&0<n.blockData.children.length?n.initChild(t):"mouseenter"===n.triggerType?(n.domContent.find(".urp-cascader-child:gt("+n.floor+")").remove(),l(e).off("click").on("click",function(){n.finishInitData()}),"initValue"===t&&l(e).trigger("click")):n.finishInitData(t)}),l(document).on("click",n.elem+","+n.elem+" ~ i.layui-icon",function(){n.onOff=!n.onOff,t++,n.onOff?(l(n.elem).siblings(".urp-cascader-content").find("ul").slideDown(100),l(n.elem).siblings("i").replaceWith('<i class="layui-icon layui-icon-up" data-cascader="icon"></i>'),n.domContent.css("zIndex",t)):(l(n.elem).siblings(".urp-cascader-content").find("ul").slideUp(100),l(n.elem).siblings("i").replaceWith('<i class="fa fa-angle-double-up" data-cascader="icon"></i>'))}),l(document).on("click",function(i){var t=l(i.target).data("cascader");"icon"!==t&&"elem"!==t&&(n.onOff=!1,n.onOff||(l(n.elem).siblings(".urp-cascader-content").find("ul").slideUp(100),l(n.elem).siblings("i").replaceWith('<i class="fa fa-angle-double-up" data-cascader="icon"></i>')))}),n.initValue()},reload:function(i){return this.domContent.off(),l(this.elem).off().siblings(".urp-cascader-content,.layui-icon").remove(),this.option=l.extend({},this.option,i),l(this.elem).val(""),this.domContent="",this.textArr=[],this.textStr="",this.valueArr=[],this.onOff=!1,this.positionArr=[],this.blockData={},this.initOption()}};i("cascader",function(i){var t=new e(i);return function(){var t=this;return{reload:function(i){t.reload.call(t,i)}}}.call(t)})});