"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}layui.define(["jquery","laytpl","layer"],function(e){var hint=layui.hint(),$=layui.jquery,laytpl=layui.laytpl,layer=layui.layer,module="autocomplete",filter="layui-autocomplete",container="layui-form-autocomplete",container_focus="layui-form-autocomplete-focus",system={config:{template:['<div class="layui-form-autocomplete">','<dl class="layui-anim layui-anim-upbit">',"</dl>","</div>"].join(""),layout:['<dd data-index="{{d.index}}">{{d.text}}</dd>'].join(""),template_txt:"{{d.text}}",template_val:"{{d.value}}",cache:!1},data:{}},callback=function(){var n=this;n.config;return{call:function(e,t){if(!n.handles[e])return hint.error(e+" handle is not defined");n.handles[e].call(n,t)}}},job=function(e){var t=this;t.config=$.extend({},t.config,system.config,e),t.render()};job.prototype.config={text:{none:"无数据",loading:"加载中"},response:{code:"code",data:"content"},request:{keywords:"keywords"},time_limit:500,pullTimer:null,data:{},temp_data:{},params:{},filter:"",method:"get",ajaxParams:{}},job.prototype.render=function(){var e=this,t=e.config;if(t.elem=$(t.elem),t.where=t.where||{},!t.elem[0])return e;var n=t.elem,a=n.next("."+container),o=e.elem=$(laytpl(t.template).render({}));t.id=e.id,a&&a.remove(),n.attr("autocomplete","off"),n.after(o),e.events()},job.prototype.pullData=function(){var _$$extend,_self=this,_config=_self.config,_elem=_config.elem,_container=_elem.next("."+container),_dom=_container.find("dl");return _config.filter?_config.cache&&0<Object.keys(_config.data).length?_self.renderData(_config.data):void $.ajax($.extend({type:_config.method||"get",url:_config.url,data:$.extend((_$$extend={},_defineProperty(_$$extend,_config.request.keywords,_config.filter),_defineProperty(_$$extend,"t",(new Date).getTime()),_$$extend),_config.params),contentType:"text/json,charset=utf-8",dataType:"json",beforeSend:function(){_container.addClass(container_focus),_dom.html(['<dd style="text-align: center" autocomplete-load>',_config.text.loading,"</dd>"].join(""))},success:function success(resp){return 0!=eval("resp."+_config.response.code)?layer.msg(eval("resp."+_config.response.data)):_config.data=eval("resp."+_config.response.data),_self.renderData(_config.data)},error:function(){hint.error("请求失败")}},_config.ajaxParams)):_self.renderData([])},job.prototype.renderData=function(e){var o=this.config,t=o.elem.next("."+container),n=t.find("dl"),r=[];o.temp_data=[],layui.each(e,function(n,a){o.cache?a instanceof Object?layui.each(a,function(e,t){if(-1<t.toString().toLowerCase().indexOf(o.filter.toLowerCase()))return o.temp_data.push(a),r.push(laytpl(o.layout).render({index:n,text:laytpl(o.template_txt).render(a)})),!0}):-1<a.toString().toLowerCase().indexOf(o.filter.toLowerCase())&&(o.temp_data.push(a),r.push(laytpl(o.layout).render({index:n,text:laytpl(o.template_txt).render(a)}))):(o.temp_data.push(a),r.push(laytpl(o.layout).render({index:n,text:laytpl(o.template_txt).render(a)})))}),n.html(r.join("")),0<r.length?t.addClass(container_focus):t.removeClass(container_focus)},job.prototype.handles={addData:function(e){var t=this.config;e instanceof Array?t.data=t.data.concat(e):t.data.push(e)},setData:function(e){this.config.data=e}},job.prototype.events=function(){var n=this,r=n.config,i=r.elem,l=i.next("."+container),c=l.find("dl");i.unbind("focus").unbind("input propertychange").on("focus",function(){r.filter=this.value,n.renderData(r.data)}).on("input propertychange",function(e){var t=this.value;clearTimeout(r.pullTimer),r.pullTimer=setTimeout(function(){r.filter=t,n.pullData()},r.time_limit)}),$(document).on("click",function(e){var t=e.target,n=c.find(t),a=0<n.length?n.closest("dd"):void 0;if(t===i[0])return!1;if(void 0!==a){if(void 0!==a.attr("autocomplete-load"))return!1;var o=r.temp_data[a.index()];i.val(laytpl(r.template_val).render(o)),null==r.onselect||r.onselect(o)}l.removeClass(container_focus)})},system.init=function(e,o){o=o||{};$(e?'input[lay-filter="'+e+'"]':"input["+filter+"]").each(function(e,t){var n=$(t).attr("lay-data");try{n=new Function("return "+n)()}catch(e){return hint.error("autocomplete元素属性lay-data配置项存在语法错误："+n)}var a=$.extend({elem:this},system.config,o,n);null!=a.url||null!=a.data&&0!==a.length||hint.error("autocomplete配置有误，缺少获取数据方式"),system.render(a)})},system.render=function(e){var t=new job(e);return callback.call(t)},system.init(),e(module,system)});