"use strict";layui.extend({codemirror:"lib/extend/codemirror/codemirror.min"}).define(["jstree","codemirror"],function(e){function t(e){var t=this;t.loading=null,t.config=a.extend({},t.config,i.config,e),layui.link(layui.cache.base+"lib/extend/codemirror/codemirror.css"),t.render()}var a=layui.jquery,d=layui.layer,n=(layui.jstree,layui.codemirror,"webide"),i={config:{},set:function(e){var t=this;return t.config=a.extend({},t.config,e),t},on:function(e,t){return layui.onevent.call(this,n,e,t)}};t.prototype.config={inrterface_file:"/interface/core",tree_elem:"#webide__tree",content_elem:"#webide__content"},t.prototype.render=function(){var n=this,i=n.config,e=a(i.elem).find(i.tree_elem),o=a(i.elem).find(i.content_elem),r='<div class="content default" style="text-align:center;">Select a file from the tree.</div>',c='<div class="content code"><textarea id="code" readonly="readonly"></textarea></div>';e.jstree({core:{data:{url:i.inrterface_file+"/file",data:function(e){return{id:e.id}}},check_callback:function(e,t,n,i,o){return(!o||!o.dnd||"i"===o.pos)&&("move_node"!==e&&"copy_node"!==e||this.get_node(t).parent!==this.get_node(n).id)},force_text:!0,themes:{responsive:!1,variant:"small",stripes:!0}},sort:function(e,t){return this.get_type(e)===this.get_type(t)?this.get_text(e)>this.get_text(t)?1:-1:this.get_type(e)>=this.get_type(t)?1:-1},contextmenu:{items:function(e){var t=a.jstree.defaults.contextmenu.items();return delete t.create.action,t.create.label="New",t.create.submenu={create_folder:{separator_after:!0,label:"Folder",action:function(e){var t=a.jstree.reference(e.reference),n=t.get_node(e.reference);t.create_node(n,{type:"default"},"last",function(e){setTimeout(function(){t.edit(e)},0)})}},create_file:{label:"File",action:function(e){var t=a.jstree.reference(e.reference),n=t.get_node(e.reference);t.create_node(n,{type:"file"},"last",function(e){setTimeout(function(){t.edit(e)},0)})}}},"file"===this.get_type(e)&&delete t.create,t}},types:{default:{icon:"folder"},file:{valid_children:[],icon:"file"}},unique:{duplicate:function(e,t){return e+" "+t}},plugins:["state","dnd","sort","types","contextmenu","unique"]}).on("delete_node.jstree",function(e,t){a.get("?operation=delete_node",{id:t.node.id}).fail(function(){t.instance.refresh()})}).on("create_node.jstree",function(e,t){a.get("?operation=create_node",{type:t.node.type,id:t.node.parent,text:t.node.text}).done(function(e){t.instance.set_id(t.node,e.id)}).fail(function(){t.instance.refresh()})}).on("rename_node.jstree",function(e,t){a.get("?operation=rename_node",{id:t.node.id,text:t.text}).done(function(e){t.instance.set_id(t.node,e.id)}).fail(function(){t.instance.refresh()})}).on("move_node.jstree",function(e,t){a.get("?operation=move_node",{id:t.node.id,parent:t.parent}).done(function(e){t.instance.refresh()}).fail(function(){t.instance.refresh()})}).on("copy_node.jstree",function(e,t){a.get("?operation=copy_node",{id:t.original.id,parent:t.parent}).done(function(e){t.instance.refresh()}).fail(function(){t.instance.refresh()})}).on("changed.jstree",function(e,t){t&&t.selected&&t.selected.length?(n.loading=d.load(),a.post(i.inrterface_file+"/file/get",{id:t.selected.join(":")},function(e){if(d.close(n.loading),0==e.errcode&&e.data.type){var t=e.data;switch(o.hide(),t.type){case"text":case"txt":case"md":case"htaccess":case"log":case"sql":case"php":case"js":case"json":case"css":case"html":o.html(c).show(),o.find("#code").val(t.content),n.renderCode();break;case"png":case"jpg":case"jpeg":case"bmp":case"gif":a("#data .image img").one("load",function(){a(this).css({marginTop:"-"+a(this).height()/2+"px",marginLeft:"-"+a(this).width()/2+"px"})}).attr("src",t.content),a("#data .image").show();break;default:o.html(r).show()}}})):(o.hide(),o.html(r).show())})},t.prototype.renderCode=function(){a(this.config.elem).find("#code"),CodeMirror.fromTextArea(a("#code")[0],{lineNumbers:!0,lineWrapping:!0,mode:"text/html"})},t.prototype.done=function(e){},i.render=function(e){return new t(e)},e(n,i)});