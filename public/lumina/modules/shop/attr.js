"use strict";layui.define(["laytpl"],function(t){var p=layui.jquery,o=(layui.laytpl,layui.layer),d={spec_attr:[],spec_list:[]},n={container:".goods-spec-many"};t("attr",{initialize:function(){this.$container=p(n.container),this.$specAttr=this.$container.find(".spec-attr"),this.showAddSpecGroupEvent(),this.submitAddSpecGroupEvent(),this.cancelAddSpecGroupEvent(),this.addSpecItemEvent(),this.deleteSpecGroupEvent(),this.deleteSpecItemEvent(),this.batchUpdateSku(),this.updateSpecInputEvent(),this.renderHtml()},showAddSpecGroupEvent:function(){this.$container.on("click",".btn-addSpecGroup",function(){var t=p(this).parent(),e=t.next();t.hide(),e.show()})},submitAddSpecGroupEvent:function(){var s=this;s.$container.on("click",".btn-addSpecName",function(){var t=p(this).parent().parent(),e=t.prev(),n=s.$container.find(".input-specName"),i=s.$container.find(".input-specValue"),c=i.val(),a=n.val();if(""===a||""===c)return o.msg("请填写规则名或规则值"),!1;var r=o.load();o.close(r),n.val("")&&i.val(""),d.spec_attr.push({group_id:1,group_name:a,spec_items:[{item_id:2..spec_value_id,spec_value:c}]}),s.renderHtml(),t.hide()&&e.show()})},cancelAddSpecGroupEvent:function(){this.$container.on("click",".btn-cancleAddSpecName",function(){var t=p(this).parent().parent(),e=t.prev();t.hide()&&e.show()})},addSpecItemEvent:function(){var i=this;i.$container.on("click",".btn-addSpecItem",function(){var t=p(this),e=t.parents(".spec-item-add").find("input").val(),n=t.parents(".spec-group-item");if(""===e)return o.msg("规格值不能为空"),!1;d.spec_attr[n.data("index")].spec_items.push({item_id:22,spec_value:e}),i.renderHtml()})},deleteSpecGroupEvent:function(){var n=this;n.$container.on("click",".spec-group-delete",function(){var e=p(this).parent().parent().attr("data-index");o.confirm("确定要删除该规则组吗？确认后不可恢复请谨慎操作",function(t){d.spec_attr.splice(e,1),n.renderHtml(),o.close(t)})})},deleteSpecItemEvent:function(){var i=this;i.$container.on("click",".spec-item-delete",function(){var t=p(this).parent(),e=t.parent().parent().attr("data-index"),n=t.attr("data-item-index");o.confirm("确定要删除该规则吗？确认后不可恢复请谨慎操作",function(t){d.spec_attr[e].spec_items.splice(n,1),i.renderHtml(),o.close(t)})})},batchUpdateSku:function(){var t=this,e=t.$container.find(".spec-batch");e.on("click",".btn-specBatchBtn",function(){var i={};e.find("input").each(function(){var t=p(this),e=t.data("type"),n=t.val();void 0!==e&&""!==e&&""!==n&&(i[e]=n)}),p.isEmptyObject(i)||(d.spec_list.forEach(function(t,e){d.spec_list[e].form=p.extend({},d.spec_list[e].form,i)}),t.renderTabelHtml())})},renderHtml:function(){this.$specAttr.html(template("tpl_spec_attr",d)),this.renderTabelHtml()},renderTabelHtml:function(){var t=this.$container.find(".spec-sku-tabel"),e=t.parent();if(0===d.spec_attr.length)return t.empty(),e.hide(),!1;this.buildSpeclist(),t.html(template("tpl_spec_table",d)),e.show()},buildSpeclist:function(){for(var t=1,e=0;e<d.spec_attr.length;e++)t*=d.spec_attr[e].spec_items.length;for(var n=[],e=0;e<t;e++){for(var i=[],c=1,a=[],r=0;r<d.spec_attr.length;r++){var s=d.spec_attr[r].spec_items,p=t/(c*=s.length),o=e/p%s.length;0==e%p&&i.push({rowspan:p,item_id:s[o].item_id,spec_value:s[o].spec_value}),a.push(s[parseInt(o.toString())].item_id)}n.push({spec_sku_id:a.join("_"),rows:i,form:{}})}if(0<d.spec_list.length&&0<n.length)for(e=0;e<n.length;e++){var l=d.spec_list.filter(function(t){return t.spec_sku_id===n[e].spec_sku_id});0<l.length&&(n[e].form=l[0].form)}d.spec_list=n},updateSpecInputEvent:function(){this.$container.find(".spec-sku-tabel").on("propertychange change","input",function(){var t=p(this),e=t.attr("name"),n=t.parent().parent().data("index");d.spec_list[n].form[e]=t.val()})},getData:function(){return d},isEmptySkuList:function(){return!d.spec_list.length},render:function(t,e){n=p.extend(!0,{},n,t),null!=e&&(d=e),this.initialize()}})});