"use strict";!function(h){function n(t){this.defined="undefined"!=typeof localStorage;var e="garlic:"+document.domain+">test";try{localStorage.setItem(e,e),localStorage.removeItem(e)}catch(t){this.defined=!1}}n.prototype={constructor:n,get:function(t,e){var i=localStorage.getItem(t);if(i){try{i=JSON.parse(i)}catch(t){}return i}return void 0!==e?e:null},has:function(t){return!!localStorage.getItem(t)},set:function(t,e,i){return""===e||e instanceof Array&&0===e.length?this.destroy(t):(e=JSON.stringify(e),localStorage.setItem(t,e)),"function"!=typeof i||i()},destroy:function(t,e){return localStorage.removeItem(t),"function"!=typeof e||e()},clean:function(t){for(var e=localStorage.length-1;0<=e;e--)void 0===Array.indexOf&&-1!==localStorage.key(e).indexOf("garlic:")&&localStorage.removeItem(localStorage.key(e));return"function"!=typeof t||t()},clear:function(t){return localStorage.clear(),"function"!=typeof t||t()}};function r(t,e,i){this.init("garlic",t,e,i)}r.prototype={constructor:r,init:function(t,e,i,n){this.type=t,this.$element=h(e),this.options=this.getOptions(n),this.storage=i,this.path=this.options.getPath(this.$element)||this.getPath(),this.parentForm=this.$element.closest("form"),this.$element.addClass("garlic-auto-save"),this.expiresFlag=!!this.options.expires&&(this.$element.data("expires")?this.path:this.getPath(this.parentForm))+"_flag",this.$element.on(this.options.events.join("."+this.type+" "),!1,h.proxy(this.persist,this)),this.options.destroy&&h(this.parentForm).on("submit reset",!1,h.proxy(this.destroy,this)),this.retrieve()},getOptions:function(t){return h.extend({},h.fn[this.type].defaults,t,this.$element.data())},persist:function(){if(this.val!==this.getVal()){this.val=this.getVal(),this.options.expires&&this.storage.set(this.expiresFlag,((new Date).getTime()+1e3*this.options.expires).toString());var t=this.options.prePersist(this.$element,this.val);"string"==typeof t&&(this.val=t),this.storage.set(this.path,this.val),this.options.onPersist(this.$element,this.val)}},getVal:function(){return this.$element.is("input[type=checkbox]")?this.$element.prop("checked")?"checked":"unchecked":this.$element.val()},retrieve:function(){if(this.storage.has(this.path)){if(this.options.expires){var t=(new Date).getTime();if(this.storage.get(this.expiresFlag)<t.toString())return void this.storage.destroy(this.path);this.$element.attr("expires-in",Math.floor((parseInt(this.storage.get(this.expiresFlag))-t)/1e3))}var e=this.$element.val(),i=this.storage.get(this.path);if("boolean"==typeof(i=this.options.preRetrieve(this.$element,e,i))&&0==i)return;return this.options.conflictManager.enabled&&this.detectConflict()?this.conflictManager():this.$element.is("input[type=radio], input[type=checkbox]")?"checked"===i||this.$element.val()===i?this.$element.prop("checked",!0):void("unchecked"===i&&this.$element.prop("checked",!1)):(this.$element.val(i),this.$element.trigger("input"),void this.options.onRetrieve(this.$element,i))}},detectConflict:function(){var t=this;if(this.$element.is("input[type=checkbox], input[type=radio]"))return!1;if(this.$element.val()&&this.storage.get(this.path)!==this.$element.val()){if(this.$element.is("select")){var e=!1;return this.$element.find("option").each(function(){0!==h(this).index()&&h(this).attr("selected")&&h(this).val()!==t.storage.get(this.path)&&(e=!0)}),e}return!0}return!1},conflictManager:function(){if("function"==typeof this.options.conflictManager.onConflictDetected&&!this.options.conflictManager.onConflictDetected(this.$element,this.storage.get(this.path)))return!1;this.options.conflictManager.garlicPriority?(this.$element.data("swap-data",this.$element.val()),this.$element.data("swap-state","garlic"),this.$element.val(this.storage.get(this.path))):(this.$element.data("swap-data",this.storage.get(this.path)),this.$element.data("swap-state","default")),this.swapHandler(),this.$element.addClass("garlic-conflict-detected"),this.$element.closest("input[type=submit]").attr("disabled",!0)},swapHandler:function(){var t=h(this.options.conflictManager.template);this.$element.after(t.text(this.options.conflictManager.message)),t.on("click",!1,h.proxy(this.swap,this))},swap:function(){var t=this.$element.data("swap-data");this.$element.data("swap-state","garlic"===this.$element.data("swap-state")?"default":"garlic"),this.$element.data("swap-data",this.$element.val()),h(this.$element).val(t),this.options.onSwap(this.$element,this.$element.data("swap-data"),t)},destroy:function(){this.storage.destroy(this.path)},remove:function(){this.destroy(),this.$element.is("input[type=radio], input[type=checkbox]")?h(this.$element).attr("checked",!1):this.$element.val("")},getPath:function(t){if(void 0===t&&(t=this.$element),this.options.getPath(t))return this.options.getPath(t);if(1!=t.length)return!1;for(var e="",i=t.is("input[type=checkbox]"),n=t;n.length;){var s=n[0],a=s.nodeName;if(!a)break;a=a.toLowerCase();var o=n.parent(),r=o.children(a);if(h(s).is("form, input, select, textarea")||i){if(a+=h(s).attr("name")?"."+h(s).attr("name"):"",1<r.length&&!h(s).is("input[type=radio]")&&(a+=":eq("+r.index(s)+")"),e=a+(e?">"+e:""),"form"==s.nodeName.toLowerCase())break;n=o}else n=o}return"garlic:"+document.domain+(this.options.domain?"*":window.location.pathname)+">"+e},getStorage:function(){return this.storage}},h.fn.garlic=function(s,t){function e(t){var e=h(t),i=e.data("garlic"),n=h.extend({},a,e.data());if((void 0===n.storage||n.storage)&&"password"!==h(t).attr("type"))return i||e.data("garlic",i=new r(t,o,n)),"string"==typeof s&&"function"==typeof i[s]?i[s]():void 0}var a=h.extend(!0,{},h.fn.garlic.defaults,s,this.data()),o=new n,i=!1;return!!o.defined&&(this.each(function(){if(h(this).is("form"))h(this).find(a.inputs).each(function(){h(this).is(a.excluded)||(i=e(h(this)))});else if(h(this).is(a.inputs)){if(h(this).is(a.excluded))return;i=e(h(this))}}),"function"==typeof t?t():i)},h.fn.garlic.Constructor=r,h.fn.garlic.defaults={destroy:!0,inputs:"input, textarea, select",excluded:'input[type="file"], input[type="hidden"], input[type="submit"], input[type="reset"]',events:["DOMAttrModified","textInput","input","change","click","keypress","paste","focus"],domain:!1,expires:!1,conflictManager:{enabled:!1,garlicPriority:!0,template:'<span class="garlic-swap"></span>',message:"This is your saved data. Click here to see default one",onConflictDetected:function(){return!0}},getPath:function(){},preRetrieve:function(t,e,i){return i},onRetrieve:function(){},prePersist:function(){return!1},onPersist:function(){},onSwap:function(){}},h(window).on("load",function(){h("[data-keep]").each(function(){h(this).garlic()})})}(window.jQuery||window.Zepto);