(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b192e116"],{2747:function(t,e,n){"use strict";var i=n("f7ab"),a=n.n(i),o=n("5880");e["a"]={replace:!0,data:function(){return{title:"",size:"small",Visible:!0}},computed:Object(o["mapState"])({Config:function(t){return t.Config},RootNodeInfo:function(t){return t.RootNodeInfo},Metadata:function(t){return t.Metadata},demoMode:function(t){return t.setting.demoMode}}),beforeCreated:function(){},created:function(){this.ema=a.a.getProxy()},beforeMount:function(){},mounted:function(){},beforeUpdate:function(){},updated:function(){},activated:function(){},deactivated:function(){},beforDestroy:function(){},destroyed:function(){this.ema.dispose()},methods:{bindEvent:function(t,e){this.$options.name||console.warn("绑定事件的组件不存在组件名称",t),this.ema.bind("".concat(this.$options.name,".").concat(t),e)},openDialog:function(t){this.ema.fire("Dialogs.push",t)},close:function(){this.ema.fire("Dialogs.close",this.$options.name)}}}},"566a":function(t,e,n){"use strict";var i=n("6088"),a=n.n(i);a.a},6088:function(t,e,n){},9761:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"psd_dialog",attrs:{title:t.title,width:"50%",center:!0,visible:t.Visible,modal:!0},on:{"update:visible":function(e){t.Visible=e},close:t.close}},[n("div",{staticClass:"wraper"},[n("span",[t._v("上传PSD文件")]),n("input",{ref:"input",attrs:{type:"file",id:"aptitude",accept:".psd"},on:{change:t.change}})]),n("div",{staticClass:"tips"},[n("section",{staticClass:"desc"},[n("h4",[t._v("上传须知")]),n("ol",[n("li",{attrs:{_tracker_click_:"_tracker_click_"}},[t._v(" 为保证上传速度，PSD文件大小不超过"),n("span",[t._v("30M")]),t._v("，图层不能超过"),n("span",[t._v("30个")]),t._v("，且每个图层不能够超过"),n("span",[t._v("5M")]),t._v("。")]),n("li",{attrs:{_tracker_click_:"_tracker_click_"}},[t._v(" 必须使用"),n("span",{staticStyle:{color:"red"}},[t._v("RGB/8")]),t._v("通道模式, 为保证图片质量，建议上传前尽量将效果合并至图层中。")])])])])])},a=[],o=n("a34a"),s=n.n(o),r=n("2747"),c=n("c455");function d(t,e,n,i,a,o,s){try{var r=t[o](s),c=r.value}catch(d){return void n(d)}r.done?e(c):Promise.resolve(c).then(i,a)}function u(t){return function(){var e=this,n=arguments;return new Promise(function(i,a){var o=t.apply(e,n);function s(t){d(o,i,a,s,r,"next",t)}function r(t){d(o,i,a,s,r,"throw",t)}s(void 0)})}}var l={mixins:[r["a"]],name:"d-psd",components:{},data:function(){return{loading:!1,env:"production",nodeTree:{id:"truck/imageid",type:"truck/image",label:"图片id",version:"0.1.10",url:"https://ymm-maliang.oss-cn-hangzhou.aliyuncs.com/truck/image/0.1.10/index.js",visible:!0,style:{position:"absolute",width:"313px",height:"226px",left:"3.453125px",top:"0px",opacity:1},props:{url:"",mode:"widthFix",click:[]},path:"https://ymm-maliang.oss-cn-hangzhou.aliyuncs.com/truck/image/0.1.10/index.js",script:[],stack:!0,childLimit:9999,leaf:!1,animate:[],events:[]},content:[],psdFile:"",psdSize:"",psdUrl:"",psdName:""}},mounted:function(){},computed:{},methods:{uptoServer:function(t){var e=new window.FormData;return e.append("file",t),Object(c["a"])({url:"editor/pages/psd-to-page",method:"post",needLoading:!1,data:e})},change:function(){var t=u(s.a.mark(function t(e){var n,i,a,o,r,c,d,u,l,p,h,f;return s.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(n=Number(this.$store.state.setting.phoneSize.width.split("px")[0]),i=this.$refs.input.files,i[0]){t.next=4;break}return t.abrupt("return");case 4:if(a=(i[0].size/1024/1024).toFixed(2),!(a>30)){t.next=7;break}return t.abrupt("return",this.$alert("psd文件不能大于30M"));case 7:return this.psdFile=i[0],this.psdSize=a,this.psdName=i[0].name,this.loading=!0,t.next=13,this.uptoServer(i[0]);case 13:o=t.sent,t.prev=14,r=o.data.data,c=r.document.width,d=(n/c).toFixed(2),u=r.elements||[],l=[],t.next=26;break;case 22:return t.prev=22,t.t0=t["catch"](14),this.loading=!1,t.abrupt("return",this.$alert(o.data.msg));case 26:if(0!=u.length){t.next=30;break}return this.loading=!1,this.$alert("未发现图层,请检查通道模式"),t.abrupt("return");case 30:for(p=0;p<u.length;p++)h=JSON.parse(JSON.stringify(this.nodeTree)),f=parseInt(1e4*Math.random()),h.id=h.id+f,h.label=h.label+f,h.style.width=u[p].width*d+"px",h.style.height=u[p].height*d+"px",h.style.left=u[p].left*d+"px",h.style.top=u[p].top*d+"px",h.props.url=u[p].src,l.push(h);this.content=l,this.loading=!1,this.open();case 34:case"end":return t.stop()}},t,this,[[14,22]])}));function e(e){return t.apply(this,arguments)}return e}(),dataURLtoFile:function(t,e){e||(e=Math.floor(1e4*Math.random())+".png"),t.startsWith("data:image/png;base64,")||(t="data:image/png;bases64,"+t);var n=t.split(","),i=n[0].match(/:(.*?);/)[1],a=window.atob(n[1]),o=a.length,s=new Uint8Array(o);while(o--)s[o]=a.charCodeAt(o);return new window.File([s],e,{type:i})},uploadOss:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e||(t=this.dataURLtoFile(t));var n="/ossupload/uploadFile",i=new window.FormData;return i.append("files",t),Object(c["a"])({url:n,method:"post",needLoading:!1,headers:{"Content-Type":"multipart/form-data"},data:i})},open:function(){var t=this;this.$confirm("文件解析成功, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e={size:t.psdSize,name:t.psdName};t.changeNode(JSON.stringify(t.content),JSON.stringify(e)),t.close()}).catch(function(){})}}},p=l,h=(n("566a"),n("2877")),f=Object(h["a"])(p,i,a,!1,null,"6076292f",null);e["default"]=f.exports}}]);